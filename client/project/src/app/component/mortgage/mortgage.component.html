<div class="container">
  <p-breadcrumb
    class="max-w-full m-2"
    [model]="breadcrumbItems"
    [home]="breadcrumbHome"
  ></p-breadcrumb>
  <div class="row justify-content-center align-items-center">
    <div class="col-8 text-center my-5 h1card">
      <h1>Mortgage Calculator</h1>
    </div>
  </div>
  <div class="row justify-content-evenly align-items-center">
    <div class="col-5 form-card">
      <div class="d-flex flex-column m-4">
        <label htmlFor="transactionName">Loan Amount</label>
        <p-inputNumber
          mode="decimal"
          [minFractionDigits]="2"
          [maxFractionDigits]="2"
          [style]="{ width: '100%' }"
          [inputStyle]="{ width: '100%' }"
          [(ngModel)]="loanAmount"
          (onInput)="calculate()"
        >
        </p-inputNumber>
        <p-slider
          [(ngModel)]="loanAmount"
          [min]="0"
          [max]="2000000"
          [step]="50000"
          (onSlideEnd)="calculate()"
        ></p-slider>
      </div>
      <div class="d-flex flex-column m-4">
        <label htmlFor="transactionName">Loan Term</label>
        <div class="p-inputgroup">
          <p-inputNumber
            id="term"
            inputId="integeronly"
            [style]="{ width: '100%' }"
            [inputStyle]="{ width: '100%' }"
            [(ngModel)]="loanTerm"
            (onInput)="calculate()"
          >
          </p-inputNumber>

          <p-dropdown
            [options]="types"
            [(ngModel)]="typeOfLoanTerm"
            optionLabel="label"
            optionValue="value"
            [style]="{ width: '100%' }"
            (onChange)="onChangeTypeOfTerm()"
          ></p-dropdown>
        </div>
        <p-slider
          [(ngModel)]="loanTerm"
          [min]="minLoanTerm"
          [max]="maxLoanTerm"
          (onSlideEnd)="calculate()"
        ></p-slider>
      </div>
      <div class="d-flex flex-column m-4">
        <label htmlFor="transactionName">Interest Rate</label>
        <p-inputNumber
          id="interest"
          mode="decimal"
          [minFractionDigits]="2"
          [maxFractionDigits]="2"
          [style]="{ width: '100%' }"
          [inputStyle]="{ width: '100%' }"
          [(ngModel)]="interestRate"
          (onInput)="calculate()"
        >
        </p-inputNumber>
        <p-slider
          [(ngModel)]="interestRate"
          [min]="0"
          [max]="100"
          (onSlideEnd)="calculate()"
        ></p-slider>
      </div>

      <div class="text-center mt-3 mb-4">
        <p-button
          label="Amortization Table"
          styleClass="p-button-rounded"
          (onClick)="getAmortizationTable()"
        ></p-button>
      </div>
    </div>

    <div class="col-4 trans-card">
      <div class="mortgage-data">
        <p class="font-monospace fw-bolder fs-3">
          Monthly Repayment:
          <span class="monthlyRepayment-color">{{
            monthlyRepayment() | currency
          }}</span>
        </p>
        <p class="font-monospace fs-5">
          Total Interest:
          <span class="interest-color">{{
            repaymentAmountData()[1] | currency
          }}</span>
        </p>
        <p class="font-monospace fs-5">
          Principal:
          <span class="principal-color">{{ loanAmount | currency }}</span>
        </p>
      </div>
      <p-chart
        type="doughnut"
        [data]="donutData"
        [options]="donutOptions"
      ></p-chart>
    </div>
  </div>

  <div
    *ngIf="showAmortizationTable"
    class="row justify-content-center align-items-center mortgage-card"
  >
    <div class="col-10">
      <p-treeTable
        id="mortgagett"
        #mortgagett
        [value]="mortgageRepaymentData"
        [columns]="mortgageTreeTableCols"
        [paginator]="true"
        [rows]="10"
        [scrollable]="true"
        [tableStyle]="{ 'min-width': '30dvh' }"
        [scrollable]="true"
        scrollHeight="500px"
      >
        <ng-template pTemplate="caption">
          <div class="d-flex justify-content-between">
            <div>
              <h3>Principal + Interest = Payment</h3>
            </div>
            <div>
              <button
                type="button"
                pButton
                pRipple
                icon="pi pi-file-excel"
                (click)="exportExcelTransaction()"
                class="p-button-success export-buttons"
                pTooltip="XLS"
                tooltipPosition="bottom"
              ></button>
              <button
                type="button"
                pButton
                pRipple
                icon="pi pi-file-pdf"
                (click)="exportPdfTransaction()"
                class="p-button-danger export-buttons"
                pTooltip="PDF"
                tooltipPosition="bottom"
              ></button>
            </div>
          </div>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th *ngFor="let col of columns">
              {{ col.header }}
            </th>
          </tr>
        </ng-template>
        <ng-template
          pTemplate="body"
          let-rowNode
          let-rowData="rowData"
          let-columns="columns"
        >
          <tr [ttRow]="rowNode">
            <!-- <td *ngFor="let col of columns; let i = index">
              <p-treeTableToggler
                [rowNode]="rowNode"
                *ngIf="i === 0"
              ></p-treeTableToggler>
              {{ rowData[col.field] | currency }}
            </td> -->
            <td>
              <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
              {{ rowData.date }}
            </td>
            <td>
              {{ rowData.principal | currency }}
            </td>
            <td>
              {{ rowData.interest | currency }}
            </td>
            <td>
              {{ rowData.payment | currency }}
            </td>
            <td>
              {{ rowData.totalInterestPaid | currency }}
            </td>
            <td>
              {{ rowData.balanceRemaining | currency }}
            </td>
          </tr>
        </ng-template>
      </p-treeTable>
    </div>
  </div>
  <p-toast></p-toast>
</div>
