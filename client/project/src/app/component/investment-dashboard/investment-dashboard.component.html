<div class="container">
  <div class="row justify-content-center align-items-center">
    <div class="col-8 text-center my-5 h1card">
      <h1>Investment Dashbooard</h1>
    </div>

    <p-tabView>
      <!-- STOCKS -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <!-- <i class="pi pi-apple"></i> -->
          <span class="mx-2">Overview</span>
        </ng-template>

        <div class="row justify-content-evenly align-items-center">
          <div
            class="col-10 d-flex justify-content-center h3-font"
            id="unrealized-profit-row"
          >
            <h2>
              Unrealized P&L :
              <span id="unrealized-profit">
                {{ unrealizedProfit | currency : "USD" : "code" }}
              </span>
              <span id="dummy-unrealized-profit"> ----</span>
            </h2>
            <span class="d-flex align-items-center ms-2">
              <p-button
                id="show-icon"
                icon="pi pi-eye"
                styleClass="p-button-rounded p-button-secondary p-button-text p-button-lg"
                (onClick)="hideProfit()"
              ></p-button>
              <p-button
                id="hide-icon"
                icon="pi pi-eye-slash"
                styleClass="p-button-rounded p-button-secondary p-button-text p-button-lg"
                (onClick)="hideProfit()"
              ></p-button>
            </span>
          </div>
        </div>

        <div class="row justify-content-evenly align-items-center">
          <div class="col-4 text-center my-2">
            <p-orderList
              [value]="stocksCount"
              [listStyle]="{ 'max-height': '30rem' }"
              filterBy="symbol"
              filterPlaceholder="Filter by symbol"
            >
              <ng-template let-stock pTemplate="item">
                <div class="flex align-items-center p-2 w-full flex-wrap">
                  <div class="w-full text-center lg:w-auto lg:text-left">
                    <span class="vertical-align-middle line-height-1">
                      <span
                        class="d-flex justify-content-center align-items-center"
                      >
                        <p-avatar
                          [image]="stock.logo"
                          styleClass="mr-2"
                          shape="circle"
                        ></p-avatar>
                        <span class="ms-2">
                          {{ stock.symbol }}
                        </span>
                      </span>
                    </span>
                  </div>
                  <div class="flex-1">
                    <h5 class="mb-2">
                      {{ stock.name }}
                    </h5>
                    <h5 class="mb-2">
                      {{ stock.marketPrice | currency }}
                      <span
                        [className]="getPerformanceClass(stock.performance)"
                      >
                        ({{ stock.performance | percent : "1.2-2" }})
                      </span>
                    </h5>
                  </div>
                  <div class="flex flex-column align-items-end">
                    <h6 class="mb-2 text-muted">
                      {{ stock.cost | currency }} | {{ stock.quantity }}
                    </h6>
                    <!-- <p-tag
                      [value]="product.inventoryStatus"
                      [severity]="getSeverity(product.inventoryStatus)"
                    ></p-tag> -->
                  </div>
                </div>
              </ng-template>
            </p-orderList>
          </div>

          <!-- LINE CHART -->
          <div class="col-7 chartcard g-2">
            <p-chart
              type="line"
              [data]="lineData"
              [options]="lineOptions"
            ></p-chart>
          </div>
        </div>

        <p-divider></p-divider>
        <div
          class="row justify-content-center align-items-center m-5 stock-card"
        >
          <div class="col-10 d-flex justify-content-center h3-font">
            <h3>Portfolio Stocks</h3>
          </div>
          <p-table
            #dt1
            [value]="stocks"
            [paginator]="true"
            [loading]="loading"
            [rows]="5"
            [showCurrentPageReport]="true"
            [tableStyle]="{ 'min-width': '50rem' }"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            [rowsPerPageOptions]="[5, 10, 15]"
            [globalFilterFields]="['symbol', 'name', 'quantity', 'date']"
          >
            <ng-template pTemplate="caption">
              <div class="d-flex justify-content-between">
                <button
                  pButton
                  label="Clear"
                  class="p-button-outlined"
                  icon="pi pi-filter-slash"
                  (click)="clear(dt1)"
                ></button>
                <span class="p-input-icon-left ml-auto">
                  <i class="pi pi-search"></i>
                  <input
                    id="input1"
                    #input1
                    pInputText
                    type="text"
                    (input)="dt1.filterGlobal(input1.value, 'contains')"
                    placeholder="Search keyword"
                  />
                </span>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 12%">
                  Symbol
                  <p-columnFilter
                    type="text"
                    field="symbol"
                    display="menu"
                  ></p-columnFilter>
                </th>
                <th style="width: 12.5%">Name</th>
                <th style="width: 12.5%" pSortableColumn="date">
                  Purchase Date <p-sortIcon field="date"></p-sortIcon>
                </th>
                <th style="width: 12%" pSortableColumn="quantity">
                  Quantity <p-sortIcon field="percentage"></p-sortIcon>
                </th>
                <th style="width: 12.5%">Bought Price</th>
                <th style="width: 12.5%">Market Price</th>
                <th style="width: 12%" pSortableColumn="percentage">
                  % Change <p-sortIcon field="percentage"></p-sortIcon>
                </th>
                <th style="width: 14%">Action</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-stock>
              <tr>
                <td>
                  <span
                    class="d-flex justify-content-evenly align-items-center"
                  >
                    <p-avatar
                      [image]="stock.logo"
                      styleClass="mr-2"
                      shape="circle"
                    ></p-avatar>
                    <span>
                      {{ stock.symbol }}
                    </span>
                  </span>
                </td>
                <td>{{ stock.name }}</td>
                <td>{{ stock.date | date }}</td>
                <td>{{ stock.quantity }}</td>
                <td>{{ stock.price | currency }}</td>
                <td>{{ stock.marketPrice | currency }}</td>
                <td [className]="getPerformanceClass(stock.percentage)">
                  {{ stock.percentage | percent : "1.2-2" }}
                </td>
                <td>
                  <span class="me-2">
                    <p-confirmPopup></p-confirmPopup>
                    <p-button
                      icon="pi pi-trash"
                      type="button"
                      styleClass="p-button-rounded p-button-danger"
                      (onClick)="
                        confirmDelete($event, stock.purchaseId, stock.symbol)
                      "
                    ></p-button>
                  </span>
                  <span class="ms-1">
                    <p-button
                      label="Sell"
                      type="button"
                      styleClass="p-button-rounded p-button-success"
                      (onClick)="sellStock(stock)"
                    ></p-button>
                  </span>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="paginatorleft">
              <p-button
                type="button"
                icon="pi pi-plus"
                styleClass="p-button-text"
                [routerLink]="'/investment'"
              ></p-button>
            </ng-template>
            <ng-template pTemplate="paginatorright">
              <p-button
                type="button"
                icon="pi pi-refresh"
                styleClass="p-button-text"
                (onClick)="refreshTable()"
              ></p-button>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>

      <!-- SELL HISTORY -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <span class="mx-2">History</span>
        </ng-template>
        <div class="row justify-content-evenly align-items-center">
          <div
            class="col-10 d-flex justify-content-center h3-font"
            id="unrealized-profit-row"
          >
            <h2>
              Realized P&L :
              <span id="unrealized-profit">
                {{ realizedProfit | currency : "USD" : "code" }}
              </span>
              <span id="dummy-unrealized-profit"> ----</span>
            </h2>
            <span class="d-flex align-items-center ms-2">
              <p-button
                id="show-icon"
                icon="pi pi-eye"
                styleClass="p-button-rounded p-button-secondary p-button-text p-button-lg"
                (onClick)="hideProfit()"
              ></p-button>
              <p-button
                id="hide-icon"
                icon="pi pi-eye-slash"
                styleClass="p-button-rounded p-button-secondary p-button-text p-button-lg"
                (onClick)="hideProfit()"
              ></p-button>
            </span>
          </div>
        </div>
        <div
          class="row justify-content-center align-items-center m-2 stock-card"
        >
          <div class="col-10 d-flex justify-content-center h3-font">
            <h3>Stock Transactions</h3>
          </div>
          <p-table
            id="dt2"
            #dt2
            [columns]="cols"
            [value]="soldStocks"
            [paginator]="true"
            [loading]="loading"
            [rows]="10"
            [showCurrentPageReport]="true"
            [tableStyle]="{ 'min-width': '50rem' }"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            [rowsPerPageOptions]="[10, 15, 20]"
            [globalFilterFields]="['symbol', 'name', 'quantity', 'date']"
            [exportHeader]="'customExportHeader'"
          >
            <ng-template pTemplate="caption">
              <div class="d-flex justify-content-between">
                <div>
                  <button
                    type="button"
                    pButton
                    pRipple
                    icon="pi pi-file"
                    (click)="dt2.exportCSV()"
                    class="export-buttons"
                    pTooltip="CSV"
                    tooltipPosition="bottom"
                  ></button>
                  <button
                    type="button"
                    pButton
                    pRipple
                    icon="pi pi-file-excel"
                    (click)="exportExcel()"
                    class="p-button-success export-buttons"
                    pTooltip="XLS"
                    tooltipPosition="bottom"
                  ></button>
                  <button
                    type="button"
                    pButton
                    pRipple
                    icon="pi pi-file-pdf"
                    (click)="exportPdf()"
                    class="p-button-danger export-buttons"
                    pTooltip="PDF"
                    tooltipPosition="bottom"
                  ></button>
                </div>
                <div>
                  <button
                    pButton
                    label="Clear"
                    class="p-button-outlined"
                    icon="pi pi-filter-slash"
                    (click)="clear(dt2)"
                  ></button>
                  <span class="p-input-icon-left ml-auto">
                    <i class="pi pi-search"></i>
                    <input
                      id="input2"
                      #input2
                      pInputText
                      type="text"
                      (input)="dt2.filterGlobal(input2.value, 'contains')"
                      placeholder="Search keyword"
                    />
                  </span>
                </div>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 14.3%">
                  Symbol
                  <p-columnFilter
                    type="text"
                    field="symbol"
                    display="menu"
                  ></p-columnFilter>
                </th>
                <th style="width: 14.3%">Name</th>
                <th style="width: 14.3%" pSortableColumn="date">
                  Sold Date <p-sortIcon field="date"></p-sortIcon>
                </th>
                <th style="width: 14.3%" pSortableColumn="quantity">
                  Quantity <p-sortIcon field="percentage"></p-sortIcon>
                </th>
                <th style="width: 14.3%">Sold Price</th>
                <th style="width: 14.3%">Net Profit</th>
                <th style="width: 14.3%" pSortableColumn="percentage">
                  % ROI <p-sortIcon field="percentage"></p-sortIcon>
                </th>
                <!-- <th style="width: 14%">Action</th> -->
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-stock>
              <tr>
                <td>
                  <span
                    class="d-flex justify-content-evenly align-items-center"
                  >
                    <p-avatar
                      [image]="stock.logo"
                      styleClass="mr-2"
                      shape="circle"
                    ></p-avatar>
                    <span>
                      {{ stock.symbol }}
                    </span>
                  </span>
                </td>
                <td>{{ stock.name }}</td>
                <td>{{ stock.date | date }}</td>
                <td>{{ stock.quantity }}</td>
                <td>{{ stock.price | currency }}</td>
                <td>{{ stock.netProfit | currency }}</td>
                <td [className]="getPerformanceClass(stock.percentage)">
                  {{ stock.percentage | percent : "1.2-2" }}
                </td>
                <!-- <td>
                  <span class="me-2">
                    <p-confirmPopup></p-confirmPopup>
                    <p-button
                      icon="pi pi-trash"
                      type="button"
                      styleClass="p-button-rounded p-button-danger"
                      (onClick)="
                        confirmDelete($event, stock.purchaseId, stock.symbol)
                      "
                    ></p-button>
                  </span>
                  <span class="ms-1">
                    <p-button
                      label="Sell"
                      type="button"
                      styleClass="p-button-rounded p-button-success"
                      (onClick)="sellStock(stock)"
                    ></p-button>
                  </span>
                </td> -->
              </tr>
            </ng-template>
            <ng-template pTemplate="paginatorleft">
              <p-button
                type="button"
                icon="pi pi-plus"
                styleClass="p-button-text"
                [routerLink]="'/investment'"
              ></p-button>
            </ng-template>
            <ng-template pTemplate="paginatorright">
              <p-button
                type="button"
                icon="pi pi-refresh"
                styleClass="p-button-text"
                (onClick)="refreshSoldStockTable()"
              ></p-button>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
  <p-toast></p-toast>
</div>
